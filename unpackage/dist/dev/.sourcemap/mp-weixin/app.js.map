{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<template>\n  <view class=\"app\">\n    <!-- 应用主容器 -->\n    \n    <!-- 授权登录弹窗 -->\n    <uni-popup ref=\"loginPopup\" type=\"dialog\" :mask-click=\"false\">\n      <view class=\"login-dialog\">\n        <view class=\"dialog-title\">登录提示</view>\n        <view class=\"dialog-content\">\n          <text class=\"content-text\">为了给您提供更好的服务，需要获取您的微信授权信息。</text>\n        </view>\n        <view class=\"dialog-buttons\">\n          <button class=\"cancel-btn\" @click=\"handleCancelLogin\">取消</button>\n          <button class=\"confirm-btn\" @click=\"handleLogin\">授权登录</button>\n        </view>\n      </view>\n    </uni-popup>\n  </view>\n</template>\n\n<script setup>\nimport { ref } from 'vue'\nimport { onLaunch, onShow, onHide } from '@dcloudio/uni-app'\n\n// 登录弹窗引用\nconst loginPopup = ref(null)\n\n// 应用启动\nonLaunch(() => {\n  console.log('App Launch')\n  // 检查登录状态\n  checkLoginStatus()\n})\n\n// 应用显示（从后台进入前台）\nonShow(() => {\n  console.log('App Show')\n  // 每次显示时都检查登录状态\n  checkLoginStatus()\n})\n\n// 应用隐藏\nonHide(() => {\n  console.log('App Hide')\n})\n\n/**\n * 检查登录状态\n */\nfunction checkLoginStatus() {\n  const token = uni.getStorageSync('token')\n  const userInfo = uni.getStorageSync('userInfo')\n  \n  // 如果没有token或用户信息，显示登录弹窗\n  if (!token || !userInfo) {\n    console.log('用户未登录，显示授权弹窗')\n    // 延迟显示弹窗，确保页面已加载\n    setTimeout(() => {\n      if (loginPopup.value) {\n        loginPopup.value.open()\n      }\n    }, 500)\n  } else {\n    console.log('用户已登录')\n  }\n}\n\n/**\n * 处理用户授权登录\n */\nfunction handleLogin() {\n  // 调用微信登录\n  uni.login({\n    provider: 'weixin',\n    success: (loginRes) => {\n      console.log('登录成功，code:', loginRes.code)\n      \n      // 获取用户信息\n      // #ifdef MP-WEIXIN\n      uni.getUserProfile({\n        desc: '用于完善用户资料',\n        success: (userRes) => {\n          console.log('获取用户信息成功:', userRes.userInfo)\n          \n          // 这里应该将code和用户信息发送到后端服务器\n          // 后端验证后返回token\n          // 这里使用模拟数据\n          const mockToken = 'mock_token_' + Date.now()\n          const userInfo = {\n            avatar: userRes.userInfo.avatarUrl,\n            nickname: userRes.userInfo.nickName,\n            phone: '' // 手机号需要单独授权获取\n          }\n          \n          // 存储token和用户信息\n          uni.setStorageSync('token', mockToken)\n          uni.setStorageSync('userInfo', userInfo)\n          \n          // 关闭弹窗\n          if (loginPopup.value) {\n            loginPopup.value.close()\n          }\n          \n          // 显示登录成功提示\n          uni.showToast({\n            title: '登录成功',\n            icon: 'success',\n            duration: 1500\n          })\n          \n          // 跳转到\"我的\"页面\n          setTimeout(() => {\n            uni.switchTab({\n              url: '/pages/my/my'\n            })\n          }, 1500)\n        },\n        fail: (err) => {\n          console.error('获取用户信息失败:', err)\n          uni.showToast({\n            title: '获取用户信息失败',\n            icon: 'none'\n          })\n          // 用户拒绝授权，退出小程序\n          setTimeout(() => {\n            uni.exitMiniProgram()\n          }, 1500)\n        }\n      })\n      // #endif\n      \n      // #ifndef MP-WEIXIN\n      // 非微信小程序环境的处理\n      const mockToken = 'mock_token_' + Date.now()\n      const userInfo = {\n        avatar: 'https://via.placeholder.com/200',\n        nickname: '游客用户',\n        phone: ''\n      }\n      \n      uni.setStorageSync('token', mockToken)\n      uni.setStorageSync('userInfo', userInfo)\n      \n      if (loginPopup.value) {\n        loginPopup.value.close()\n      }\n      \n      uni.showToast({\n        title: '登录成功',\n        icon: 'success'\n      })\n      \n      setTimeout(() => {\n        uni.switchTab({\n          url: '/pages/my/my'\n        })\n      }, 1500)\n      // #endif\n    },\n    fail: (err) => {\n      console.error('登录失败:', err)\n      uni.showToast({\n        title: '登录失败',\n        icon: 'none'\n      })\n      // 登录失败，退出小程序\n      setTimeout(() => {\n        uni.exitMiniProgram()\n      }, 1500)\n    }\n  })\n}\n\n/**\n * 处理取消登录\n */\nfunction handleCancelLogin() {\n  uni.showModal({\n    title: '提示',\n    content: '未登录将无法使用完整功能，确定要退出吗？',\n    success: (res) => {\n      if (res.confirm) {\n        // 关闭弹窗\n        if (loginPopup.value) {\n          loginPopup.value.close()\n        }\n        // 退出小程序\n        uni.exitMiniProgram()\n      }\n    }\n  })\n}\n</script>\n\n<style>\n/* 全局样式 */\n@import './static/styles/common.css';\n\n/* 重置默认样式 */\npage {\n  background-color: #f5f5f5;\n  font-size: 28rpx;\n  color: #333;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n}\n\n/* 清除按钮默认样式 */\nbutton::after {\n  border: none;\n}\n\n/* 图片默认样式 */\nimage {\n  display: block;\n}\n\n/* 登录弹窗样式 */\n.login-dialog {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 40rpx;\n  width: 580rpx;\n}\n\n.dialog-title {\n  font-size: 36rpx;\n  font-weight: 600;\n  color: #333;\n  text-align: center;\n  margin-bottom: 30rpx;\n}\n\n.dialog-content {\n  margin-bottom: 40rpx;\n}\n\n.content-text {\n  font-size: 28rpx;\n  color: #666;\n  line-height: 1.6;\n  text-align: center;\n  display: block;\n}\n\n.dialog-buttons {\n  display: flex;\n  gap: 20rpx;\n}\n\n.cancel-btn,\n.confirm-btn {\n  flex: 1;\n  height: 80rpx;\n  border-radius: 40rpx;\n  font-size: 28rpx;\n  border: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.cancel-btn {\n  background-color: #f5f5f5;\n  color: #666;\n}\n\n.confirm-btn {\n  background: linear-gradient(135deg, #3cc51f 0%, #2fb015 100%);\n  color: #fff;\n}\n\n.cancel-btn::after,\n.confirm-btn::after {\n  border: none;\n}\n</style>\n","import App from './App.vue'\n\n// #ifndef VUE3\nimport Vue from 'vue'\nimport './uni.promisify.adaptor'\nVue.config.productionTip = false\nApp.mpType = 'app'\nconst app = new Vue({\n  ...App\n})\napp.$mount()\n// #endif\n\n// #ifdef VUE3\nimport { createSSRApp } from 'vue'\nexport function createApp() {\n  const app = createSSRApp(App)\n  return {\n    app\n  }\n}\n// #endif\n"],"names":["ref","onLaunch","uni","onShow","onHide","createSSRApp","App"],"mappings":";;;;;;;;;;;;;;;;;AAyBA,UAAM,aAAaA,cAAG,IAAC,IAAI;AAG3BC,kBAAAA,SAAS,MAAM;AACbC,oBAAAA,MAAA,MAAA,OAAA,iBAAY,YAAY;AAExB,uBAAkB;AAAA,IACpB,CAAC;AAGDC,kBAAAA,OAAO,MAAM;AACXD,oBAAAA,MAAA,MAAA,OAAA,iBAAY,UAAU;AAEtB,uBAAkB;AAAA,IACpB,CAAC;AAGDE,kBAAAA,OAAO,MAAM;AACXF,oBAAAA,MAAA,MAAA,OAAA,iBAAY,UAAU;AAAA,IACxB,CAAC;AAKD,aAAS,mBAAmB;AAC1B,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,YAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAG9C,UAAI,CAAC,SAAS,CAAC,UAAU;AACvBA,sBAAAA,oCAAY,cAAc;AAE1B,mBAAW,MAAM;AACf,cAAI,WAAW,OAAO;AACpB,uBAAW,MAAM,KAAM;AAAA,UACxB;AAAA,QACF,GAAE,GAAG;AAAA,MACV,OAAS;AACLA,sBAAAA,MAAY,MAAA,OAAA,iBAAA,OAAO;AAAA,MACpB;AAAA,IACH;AAKA,aAAS,cAAc;AAErBA,oBAAAA,MAAI,MAAM;AAAA,QACR,UAAU;AAAA,QACV,SAAS,CAAC,aAAa;AACrBA,wBAAY,MAAA,MAAA,OAAA,iBAAA,cAAc,SAAS,IAAI;AAIvCA,wBAAAA,MAAI,eAAe;AAAA,YACjB,MAAM;AAAA,YACN,SAAS,CAAC,YAAY;AACpBA,4BAAA,MAAA,MAAA,OAAA,iBAAY,aAAa,QAAQ,QAAQ;AAKzC,oBAAM,YAAY,gBAAgB,KAAK,IAAK;AAC5C,oBAAM,WAAW;AAAA,gBACf,QAAQ,QAAQ,SAAS;AAAA,gBACzB,UAAU,QAAQ,SAAS;AAAA,gBAC3B,OAAO;AAAA;AAAA,cACR;AAGDA,kCAAI,eAAe,SAAS,SAAS;AACrCA,kCAAI,eAAe,YAAY,QAAQ;AAGvC,kBAAI,WAAW,OAAO;AACpB,2BAAW,MAAM,MAAO;AAAA,cACzB;AAGDA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO;AAAA,gBACP,MAAM;AAAA,gBACN,UAAU;AAAA,cACtB,CAAW;AAGD,yBAAW,MAAM;AACfA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,KAAK;AAAA,gBACnB,CAAa;AAAA,cACF,GAAE,IAAI;AAAA,YACR;AAAA,YACD,MAAM,CAAC,QAAQ;AACbA,4BAAAA,MAAc,MAAA,SAAA,kBAAA,aAAa,GAAG;AAC9BA,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO;AAAA,gBACP,MAAM;AAAA,cAClB,CAAW;AAED,yBAAW,MAAM;AACfA,8BAAAA,MAAI,gBAAiB;AAAA,cACtB,GAAE,IAAI;AAAA,YACR;AAAA,UACT,CAAO;AAAA,QA8BF;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAAA,MAAA,MAAA,SAAA,kBAAc,SAAS,GAAG;AAC1BA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAED,qBAAW,MAAM;AACfA,0BAAAA,MAAI,gBAAiB;AAAA,UACtB,GAAE,IAAI;AAAA,QACR;AAAA,MACL,CAAG;AAAA,IACH;AAKA,aAAS,oBAAoB;AAC3BA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AAEf,gBAAI,WAAW,OAAO;AACpB,yBAAW,MAAM,MAAO;AAAA,YACzB;AAEDA,0BAAAA,MAAI,gBAAiB;AAAA,UACtB;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;AChLO,SAAS,YAAY;AAC1B,QAAM,MAAMG,cAAY,aAACC,SAAG;AAC5B,SAAO;AAAA,IACL;AAAA,EACD;AACH;;;"}