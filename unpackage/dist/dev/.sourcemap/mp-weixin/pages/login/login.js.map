{"version":3,"file":"login.js","sources":["pages/login/login.vue","pages/login/login.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"login-container\">\n    <view class=\"login-content\">\n      <view class=\"logo\">\n        <image src=\"/static/logo.png\" mode=\"aspectFit\" class=\"logo-img\"></image>\n      </view>\n      <view class=\"title\">钓点管理</view>\n      <view class=\"subtitle\">获取您的授权信息</view>\n    </view>\n    \n    <!-- 授权按钮 -->\n    <button \n      class=\"auth-btn\" \n      @click=\"handleAuth\"\n    >\n      微信授权登录\n    </button>\n    \n    <view class=\"tips\">\n      点击授权即表示您已同意《用户协议》和《隐私政策》\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { onUnload } from '@dcloudio/uni-app'\n\n// 处理授权点击\nfunction handleAuth() {\n  // #ifdef MP-WEIXIN\n  // 在微信小程序中，getUserProfile会从底部弹出授权弹窗\n  uni.getUserProfile({\n    desc: '用于完善用户资料',\n    success: (res) => {\n      console.log('获取用户信息成功:', res.userInfo)\n      // 用户同意授权\n      handleAuthSuccess(res.userInfo)\n    },\n    fail: (err) => {\n      console.error('用户拒绝授权:', err)\n      // 用户拒绝授权\n      handleAuthCancel()\n    }\n  })\n  // #endif\n  \n  // #ifndef MP-WEIXIN\n  // 非微信小程序环境\n  const mockUserInfo = {\n    avatarUrl: 'http://p3.diaoyur.cn/group3/M00/0B/4C/cjd0iVhwYF-xmeuqfNBk9gLpv4atJ.jpeg',\n    nickName: '游客用户',\n    gender: 0,\n    city: '',\n    province: '',\n    country: ''\n  }\n  handleAuthSuccess(mockUserInfo)\n  // #endif\n}\n\n// 获取用户信息回调（保留用于兼容）\nfunction onGetUserInfo(e) {\n  if (e.detail.userInfo) {\n    // 用户同意授权\n    handleAuthSuccess(e.detail.userInfo)\n  } else {\n    // 用户拒绝授权\n    handleAuthCancel()\n  }\n}\n\n\n// 处理授权成功\nasync function handleAuthSuccess(userInfo) {\n  try {\n    // 调用微信登录\n    const loginRes = await uni.login({ provider: 'weixin' })\n    console.log('登录成功，code:', loginRes.code)\n    \n    // 这里应该将code和用户信息发送到后端服务器\n    // 后端验证后返回token\n    // 这里使用模拟数据\n    const mockToken = 'mock_token_' + Date.now()\n    const fullUserInfo = {\n      ...userInfo,\n      phone: '' // 手机号需要单独授权获取\n    }\n    \n    // 存储token和用户信息\n    uni.setStorageSync('token', mockToken)\n    uni.setStorageSync('userInfo', fullUserInfo)\n    \n    uni.showToast({\n      title: '登录成功',\n      icon: 'success',\n      duration: 1500\n    })\n    \n    // 跳转到\"我的\"页面\n    setTimeout(() => {\n      uni.switchTab({\n        url: '/pages/my/my'\n      })\n    }, 1500)\n  } catch (error) {\n    console.error('登录失败:', error)\n    uni.showToast({\n      title: '登录失败',\n      icon: 'none'\n    })\n  }\n}\n\n// 处理授权取消\nfunction handleAuthCancel() {\n  uni.showModal({\n    title: '提示',\n    content: '未授权将无法使用完整功能，确定要退出吗？',\n    success: (res) => {\n      if (res.confirm) {\n        // 退出小程序\n        uni.exitMiniProgram()\n      }\n    }\n  })\n}\n\n// 页面卸载时的处理\nonUnload(() => {\n  console.log('登录页面卸载')\n})\n</script>\n\n<style scoped>\n.login-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 100vh;\n  background: linear-gradient(135deg, #3cc51f 0%, #2fb015 100%);\n  padding: 0 60rpx;\n  box-sizing: border-box;\n}\n\n.login-content {\n  text-align: center;\n  margin-bottom: 100rpx;\n}\n\n.logo {\n  width: 160rpx;\n  height: 160rpx;\n  margin: 0 auto 40rpx;\n  border-radius: 20rpx;\n  overflow: hidden;\n  background-color: #fff;\n}\n\n.logo-img {\n  width: 100%;\n  height: 100%;\n}\n\n.title {\n  font-size: 48rpx;\n  font-weight: 600;\n  color: #fff;\n  margin-bottom: 20rpx;\n}\n\n.subtitle {\n  font-size: 28rpx;\n  color: rgba(255, 255, 255, 0.8);\n}\n\n.auth-btn {\n  width: 600rpx;\n  height: 80rpx;\n  background: #fff;\n  color: #3cc51f;\n  font-size: 32rpx;\n  font-weight: 600;\n  border-radius: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 80rpx 0;\n  box-shadow: 0 8rpx 20rpx rgba(0, 0, 0, 0.1);\n}\n\n.auth-btn::after {\n  border: none;\n}\n\n.tips {\n  font-size: 24rpx;\n  color: rgba(255, 255, 255, 0.7);\n  text-align: center;\n  line-height: 1.5;\n  max-width: 600rpx;\n}\n</style>","import MiniProgramPage from '/Users/wenyixi/other-workspace/miniprograms/fishing-spots/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","onUnload"],"mappings":";;;;;;AA4BA,aAAS,aAAa;AAGpBA,oBAAAA,MAAI,eAAe;AAAA,QACjB,MAAM;AAAA,QACN,SAAS,CAAC,QAAQ;AAChBA,wBAAA,MAAA,MAAA,OAAA,+BAAY,aAAa,IAAI,QAAQ;AAErC,4BAAkB,IAAI,QAAQ;AAAA,QAC/B;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAAA,MAAc,MAAA,SAAA,+BAAA,WAAW,GAAG;AAE5B,2BAAkB;AAAA,QACnB;AAAA,MACL,CAAG;AAAA,IAeH;AAeA,mBAAe,kBAAkB,UAAU;AACzC,UAAI;AAEF,cAAM,WAAW,MAAMA,cAAG,MAAC,MAAM,EAAE,UAAU,UAAU;AACvDA,sBAAA,MAAA,MAAA,OAAA,+BAAY,cAAc,SAAS,IAAI;AAKvC,cAAM,YAAY,gBAAgB,KAAK,IAAK;AAC5C,cAAM,eAAe;AAAA,UACnB,GAAG;AAAA,UACH,OAAO;AAAA;AAAA,QACR;AAGDA,4BAAI,eAAe,SAAS,SAAS;AACrCA,4BAAI,eAAe,YAAY,YAAY;AAE3CA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,QAChB,CAAK;AAGD,mBAAW,MAAM;AACfA,wBAAAA,MAAI,UAAU;AAAA,YACZ,KAAK;AAAA,UACb,CAAO;AAAA,QACF,GAAE,IAAI;AAAA,MACR,SAAQ,OAAO;AACdA,sBAAAA,qDAAc,SAAS,KAAK;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAAA,IACH;AAGA,aAAS,mBAAmB;AAC1BA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AAEfA,0BAAAA,MAAI,gBAAiB;AAAA,UACtB;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGAC,kBAAAA,SAAS,MAAM;AACbD,oBAAAA,MAAY,MAAA,OAAA,gCAAA,QAAQ;AAAA,IACtB,CAAC;;;;;;;;;;ACjID,GAAG,WAAW,eAAe;"}