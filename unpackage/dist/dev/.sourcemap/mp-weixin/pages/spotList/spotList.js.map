{"version":3,"file":"spotList.js","sources":["pages/spotList/spotList.vue","pages/spotList/spotList.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 搜索栏 -->\n    <view class=\"search-wrapper\">\n      <uni-search-bar \n        v-model=\"searchKeyword\" \n        placeholder=\"搜索钓点名称\" \n        @confirm=\"handleSearch\"\n        @clear=\"handleClear\"\n        cancelButton=\"none\"\n      ></uni-search-bar>\n    </view>\n\n    <!-- 钓点列表 -->\n    <view class=\"list-wrapper\">\n      <view \n        v-for=\"item in spotList\" \n        :key=\"item.id\" \n        class=\"list-item\"\n        @click=\"goToDetail(item.id)\"\n      >\n        <image \n          :src=\"item.imageUrl || '/static/default-spot.png'\" \n          class=\"spot-image\"\n          mode=\"aspectFill\"\n        ></image>\n        <view class=\"spot-info\">\n          <view class=\"spot-name\">{{ item.name }}</view>\n          <view class=\"spot-type\">\n            <uni-tag \n              :text=\"item.type === 'wild' ? '野河' : '黑坑'\" \n              :type=\"item.type === 'wild' ? 'success' : 'primary'\"\n              size=\"small\"\n            ></uni-tag>\n          </view>\n        </view>\n      </view>\n\n      <!-- 空状态 -->\n      <view v-if=\"spotList.length === 0 && !loading\" class=\"empty-state\">\n        <uni-icons type=\"location\" size=\"80\" color=\"#ccc\"></uni-icons>\n        <text class=\"empty-text\">暂无钓点数据</text>\n      </view>\n\n      <!-- 加载状态 -->\n      <view v-if=\"loading\" class=\"loading-wrapper\">\n        <uni-icons type=\"spinner-cycle\" size=\"30\" color=\"#3cc51f\"></uni-icons>\n        <text class=\"loading-text\">加载中...</text>\n      </view>\n\n      <!-- 加载更多提示 -->\n      <view v-if=\"spotList.length > 0 && !hasMore\" class=\"no-more\">\n        已加载全部数据\n      </view>\n    </view>\n\n    <!-- 新增钓点按钮 -->\n    <view class=\"add-btn\" @click=\"goToAdd\">\n      <uni-icons type=\"plus\" size=\"24\" color=\"#fff\"></uni-icons>\n      <text class=\"add-text\">新增钓点</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { onLoad, onReachBottom, onPullDownRefresh, onShow } from '@dcloudio/uni-app'\n\n// 响应式数据\nconst searchKeyword = ref('') // 搜索关键词\nconst spotList = ref([]) // 钓点列表\nconst currentPage = ref(1) // 当前页码\nconst pageSize = ref(15) // 每页数量\nconst totalPages = ref(0) // 总页数\nconst loading = ref(false) // 加载状态\nconst hasMore = ref(true) // 是否还有更多数据\n\n// 页面加载时\nonLoad(() => {\n  loadSpotList()\n})\n\n// 页面显示时\nonShow(() => {\n  // 监听登录事件\n  uni.$on('triggerLogin', handleLogin)\n})\n\n// 页面挂载时\nonMounted(() => {\n  // 可以在这里执行其他初始化操作\n})\n\n/**\n * 处理登录\n */\nfunction handleLogin() {\n  // #ifdef MP-WEIXIN\n  // 在微信小程序中，getUserProfile会从底部弹出授权弹窗\n  uni.getUserProfile({\n    desc: '用于完善用户资料',\n    success: (res) => {\n      console.log('获取用户信息成功:', res.userInfo)\n      // 用户同意授权\n      handleAuthSuccess(res.userInfo)\n    },\n    fail: (err) => {\n      console.error('用户拒绝授权:', err)\n      // 用户拒绝授权\n      uni.showToast({\n        title: '需要授权才能使用',\n        icon: 'none'\n      })\n    }\n  })\n  // #endif\n  \n  // #ifndef MP-WEIXIN\n  // 非微信小程序环境\n  const mockUserInfo = {\n    avatarUrl: 'http://p3.diaoyur.cn/group3/M00/0B/4C/cjd0iVhwYF-xmeuqfNBk9gLpv4atJ.jpeg',\n    nickName: '游客用户',\n    gender: 0,\n    city: '',\n    province: '',\n    country: ''\n  }\n  handleAuthSuccess(mockUserInfo)\n  // #endif\n}\n\n/**\n * 处理授权成功\n */\nasync function handleAuthSuccess(userInfo) {\n  console.log('用户授权成功，用户信息:', userInfo)\n  \n  try {\n    // 调用后端接口，传递用户信息\n    const response = await mockLoginApi(userInfo)\n    \n    if (response.success) {\n      // 保存token和用户信息到本地存储\n      uni.setStorageSync('token', response.data.token)\n      uni.setStorageSync('userInfo', response.data.userInfo)\n      \n      uni.showToast({\n        title: '登录成功',\n        icon: 'success'\n      })\n      \n      // 延迟跳转到\"我的\"tab\n      setTimeout(() => {\n        uni.switchTab({\n          url: '/pages/my/my'\n        })\n      }, 1500)\n    } else {\n      uni.showToast({\n        title: response.message || '登录失败',\n        icon: 'none'\n      })\n    }\n  } catch (error) {\n    console.error('登录失败:', error)\n    uni.showToast({\n      title: '登录失败，请重试',\n      icon: 'none'\n    })\n  }\n}\n\n/**\n * 模拟登录API\n * 实际项目中应替换为真实的API请求\n */\nfunction mockLoginApi(userInfo) {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve({\n        success: true,\n        data: {\n          token: 'mock_token_' + Date.now(),\n          userInfo: {\n            id: 1,\n            avatarUrl: userInfo.avatarUrl,\n            nickName: userInfo.nickName,\n            gender: userInfo.gender,\n            phone: '13800138000'\n          }\n        },\n        message: '登录成功'\n      })\n    }, 500)\n  })\n}\n\n/**\n * 加载钓点列表\n */\nconst loadSpotList = async (isRefresh = false) => {\n  if (loading.value) return\n  \n  // 如果是刷新，重置页码\n  if (isRefresh) {\n    currentPage.value = 1\n    spotList.value = []\n    hasMore.value = true\n  }\n\n  loading.value = true\n\n  try {\n    // 模拟API请求 - 实际项目中替换为真实API\n    const response = await mockGetSpotList({\n      page: currentPage.value,\n      pageSize: pageSize.value,\n      keyword: searchKeyword.value\n    })\n\n    if (response.success) {\n      // 如果是第一页，直接替换数据；否则追加数据\n      if (currentPage.value === 1) {\n        spotList.value = response.data.list\n      } else {\n        spotList.value = [...spotList.value, ...response.data.list]\n      }\n\n      totalPages.value = response.data.totalPages\n      hasMore.value = currentPage.value < totalPages.value\n\n      // 如果还有更多数据，页码+1\n      if (hasMore.value) {\n        currentPage.value++\n      }\n    } else {\n      uni.showToast({\n        title: response.message || '加载失败',\n        icon: 'none'\n      })\n    }\n  } catch (error) {\n    console.error('加载钓点列表失败:', error)\n    uni.showToast({\n      title: '网络错误',\n      icon: 'none'\n    })\n  } finally {\n    loading.value = false\n  }\n}\n\n/**\n * 搜索处理\n */\nconst handleSearch = () => {\n  currentPage.value = 1\n  loadSpotList(true)\n}\n\n/**\n * 清空搜索\n */\nconst handleClear = () => {\n  searchKeyword.value = ''\n  currentPage.value = 1\n  loadSpotList(true)\n}\n\n/**\n * 跳转到钓点详情\n */\nconst goToDetail = (id) => {\n  uni.navigateTo({\n    url: `/pages/spotDetail/spotDetail?id=${id}`\n  })\n}\n\n/**\n * 跳转到新增钓点\n */\nconst goToAdd = () => {\n  uni.navigateTo({\n    url: '/pages/addSpot/addSpot'\n  })\n}\n\n/**\n * 下拉刷新\n */\nonPullDownRefresh(() => {\n  loadSpotList(true).then(() => {\n    uni.stopPullDownRefresh()\n  })\n})\n\n/**\n * 上拉加载更多\n */\nonReachBottom(() => {\n  if (hasMore.value && !loading.value) {\n    loadSpotList()\n  }\n})\n\n/**\n * 模拟API请求 - 获取钓点列表\n * 实际项目中应替换为真实的API请求\n */\nconst mockGetSpotList = ({ page, pageSize, keyword }) => {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      // 模拟数据\n      const mockData = []\n      const totalCount = 45 // 模拟总数据量\n\n      const startIndex = (page - 1) * pageSize\n      const endIndex = Math.min(startIndex + pageSize, totalCount)\n\n      for (let i = startIndex; i < endIndex; i++) {\n        mockData.push({\n          id: i + 1,\n          name: keyword ? `${keyword}相关钓点${i + 1}` : `钓点${i + 1}`,\n          imageUrl: 'http://p3.diaoyur.cn/group3/M00/0B/4C/cjd0iVhwYF-xmeuqfNBk9gLpv4atJ.jpeg',\n          type: i % 2 === 0 ? 'wild' : 'black',\n          createTime: new Date().toISOString()\n        })\n      }\n\n      // 如果有搜索关键词，过滤数据\n      const filteredData = keyword \n        ? mockData.filter(item => item.name.includes(keyword))\n        : mockData\n\n      resolve({\n        success: true,\n        data: {\n          list: filteredData,\n          totalPages: Math.ceil(totalCount / pageSize),\n          currentPage: page\n        }\n      })\n    }, 500)\n  })\n}\n</script>\n\n<style scoped>\n.container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  padding-bottom: 100rpx;\n}\n\n.search-wrapper {\n  background-color: #fff;\n  padding: 20rpx;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);\n}\n\n.list-wrapper {\n  padding: 20rpx;\n}\n\n.list-item {\n  display: flex;\n  background-color: #fff;\n  border-radius: 12rpx;\n  overflow: hidden;\n  margin-bottom: 20rpx;\n  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);\n  transition: all 0.3s;\n}\n\n.list-item:active {\n  transform: scale(0.98);\n  opacity: 0.9;\n}\n\n.spot-image {\n  width: 200rpx;\n  height: 150rpx;\n  flex-shrink: 0;\n}\n\n.spot-info {\n  flex: 1;\n  padding: 20rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n\n.spot-name {\n  font-size: 32rpx;\n  font-weight: 600;\n  color: #333;\n  margin-bottom: 10rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.spot-type {\n  display: flex;\n  align-items: center;\n}\n\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 100rpx 0;\n}\n\n.empty-text {\n  margin-top: 20rpx;\n  font-size: 28rpx;\n  color: #999;\n}\n\n.loading-wrapper {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 40rpx 0;\n}\n\n.loading-text {\n  margin-left: 10rpx;\n  font-size: 28rpx;\n  color: #999;\n}\n\n.no-more {\n  text-align: center;\n  padding: 30rpx 0;\n  font-size: 26rpx;\n  color: #999;\n}\n\n.add-btn {\n  position: fixed;\n  right: 30rpx;\n  bottom: 30rpx;\n  padding: 0 40rpx;\n  height: 88rpx;\n  background: linear-gradient(135deg, #3cc51f 0%, #2fb015 100%);\n  border-radius: 44rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 10rpx;\n  box-shadow: 0 8rpx 24rpx rgba(60, 197, 31, 0.4);\n  z-index: 999;\n  transition: all 0.3s;\n}\n\n.add-text {\n  font-size: 28rpx;\n  font-weight: 600;\n  color: #fff;\n}\n\n.add-btn:active {\n  transform: scale(0.95);\n  box-shadow: 0 4rpx 16rpx rgba(60, 197, 31, 0.3);\n}\n</style>\n","import MiniProgramPage from '/Users/wenyixi/other-workspace/miniprograms/fishing-spots/pages/spotList/spotList.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","onShow","uni","onMounted","onPullDownRefresh","onReachBottom","pageSize"],"mappings":"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"}